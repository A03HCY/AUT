{% extends "head.html" %}
{% block body %}

<style>
    img{
        display:block;
        width:100%;
        height:200px;
        object-fit:cover
    }
</style>

<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
<script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
<script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>

<div class="mdui-card">
    <div class="mdui-card-media">
        <img height="200" src="https://area.sinaapp.com/bingImg/"/>
      <div class="mdui-card-media-covered">
        <div class="mdui-card-primary">
          <div class="mdui-card-primary-title">上传你的文件</div>
          <div class="mdui-card-primary-subtitle">Upload</div>
        </div>
      </div>
    </div>
    <div class="mdui-card-actions">
        <button onclick="document.getElementById('media').click()" class="mdui-btn mdui-ripple">选择文件</button>
        <form action="/upload" method="POST" enctype="multipart/form-data">

            <div class="mdui-textfield mdui-m-t-1">
                <input name="title" id="title" class="mdui-textfield-input" type="text" placeholder="标题"/>
            </div>

            <div class="mdui-textfield mdui-m-t-1">
                <textarea name="jianjie" class="mdui-textfield-input" rows="4" placeholder="简介"></textarea>
            </div>

            <input class="mdui-hidden" type="file" id="media" name="media">
            <button type="submit" class="mdui-btn mdui-ripple mdui-m-t-1">提交</button>
        </form>
        <div class="progress mdui-m-t-1" style="display: none;" >
            <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                0%
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $('form').on('submit', function (event) {
        var x = document.getElementById('media').files[0];
        if (x == null) {
            mdui.snackbar({
            message: '请选择文件',
            position: 'right-bottom'
            });
            return false;
        }
        var x = document.getElementById('title').value;
        if (x == null || x == "") {
            mdui.snackbar({
            message: '请填写标题',
            position: 'right-bottom'
            });
            return false;
        }
        // 显示进度条
        $('.progress').css('display', 'block');
        // 阻止元素发生默认的行为，此处用来阻止对表单的提交
        event.preventDefault();
        var formData = new FormData(this);
        // jQuery Ajax 上传文件，关键在于设置：processData 和 contentType
        $.ajax({
            xhr: function () {
                var xhr = new XMLHttpRequest();
                mdui.snackbar({
                message: '开始上传...',
                position: 'right-bottom'
                });
                xhr.upload.addEventListener('progress', function (e) {
                    if (e.lengthComputable) {
                        var percent = Math.round(e.loaded * 100 / e.total);
                        $('.progress-bar').attr('aria-valuenow', percent).css('width', percent + '%').text(percent + '%');
                    }
                });
                return xhr;
            },
            type: 'POST',
            url: '/upload',
            cache: false,
            data: formData,
            // 告诉 jQuery 不要去处理发送的数据
            processData: false,
            // 告诉 jQuery 不要去设置 Content-Type 请求头
            // 因为这里是由 <form> 表单构造的 FormData 对象，且已经声明了属性 enctype="multipart/form-data"，所以设置为 false
            contentType: false
        }).done(function (res) {
            mdui.snackbar({
            message: '上传成功！',
            position: 'right-bottom'
            });
        }).fail(function (res) {
            mdui.snackbar({
            message: '上传失败！',
            position: 'right-bottom'
            });
        });
    });
</script>

{% endblock %}